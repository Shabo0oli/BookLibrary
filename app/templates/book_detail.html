{% extends "base.html" %}
{% block mycontent %}
    <div class="jumbotron">
        <h1 class="page-header">{{ book.title }}
            <br>
            {% if book.subtitle %}
                <small>{{ book.subtitle }}</small>
            {% endif %}
        </h1>
        <ul class="list-group">
            <li class="list-group-item">作者: {{ book.author }}</li>
            <li class="list-group-item">ISBN: {{ book.isbn }}</li>
            <li class="list-group-item">书籍分类: {{ book.category }}</li>
            <li class="list-group-item">馆藏 / 可借: {{ book.numbers }} / {{ book.can_borrow_number() }}</li>
        </ul>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">内容简介</h3>
            </div>
            <div class="panel-body">
                {{ book.description }}
            </div>
        </div>

        {% if g.user.is_authenticated %}
            {% if g.user.borrowing(book) %}
                <td><a class="btn btn-primary" href="{{ url_for('giveback',bid=book.id) }}">
                    归还
                </a></td>
            {% else %}
                <td><a class="btn btn-success" href="{{ url_for('book_borrow',bid=book.id) }}"
                       {% if not book.can_borrow() %}disabled="disabled"{% endif %}>
                    借阅
                </a></td>
            {% endif %}
        {% endif %}

        {% if borrowing_data %}
            <table class="table table-striped table-hover">
                <caption>当前借阅</caption>
                <thead>
                <tr>
                    <th>借阅者</th>
                    <th>借阅时间</th>
                </tr>
                </thead>
                <tbody>
                {% for data in borrowing_data %}
                    <tr>
                        <td><a href="{{ url_for('user_detail',uid=data[0].id) }}">{{ data[0].name }}</a>
                        </td>
                        <td>{{ data[1] }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}

        {% if borrowed_data %}
            <table class="table table-striped table-hover">
            <caption>历史借阅</caption>
            <thead>
            <tr>
                <th>借阅者</th>
                <th>借阅时间</th>
            </tr>
            </thead>
            <tbody>


            {% for data in borrowed_data %}
                <tr>
                    <td><a href="{{ url_for('user_detail',uid=data[0].id) }}">{{ data[0].name }}</a>
                    </td>
                    <td>{{ data[1] }}</td>
                </tr>
            {% endfor %}
            </tbody>
        {% endif %}
        </table>
    </div>
{% endblock %}